<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>WauwMuseum – Din interaktive ven på museet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/art_interface.css">

    <script src="js/AndroidMockup.js"></script>
    <script src="js/appInteraction.js"></script>
    <script src="js/ServerCommunication.js"></script>
</head>
<body>

    <div class="panel left">
        <img src="image/smk_logo.png" id="picture_main">
        <div id="name_work"></div>
        <div>af <span id="name_artist"></span></div>
        <div id="date_work"></div>
        <div id="size_work"></div>
        <div id="controls">
            <img id="keep" src="image/control_keep.png">
            <img id="listen" src="image/control_listen.png">
            <img id="play" src="image/control_play.png">
            <img id="record" src="image/control_record.png">
            <div id="audio_player"></div>
        </div>
    </div>
    <div class="panel right">
        <div id="description"></div>
        <p>Beacon: <span id="best_beacon"></span></p>
    </div>

    <script>
        var strBestBeaconId,
            blnAudioPlaying = false,
            elBestBeacon = document.getElementById("best_beacon"),
            elPictureMain = document.getElementById("picture_main"),
            elNameArtist = document.getElementById("name_artist"),
            elNameWork = document.getElementById("name_work"),
            elDateWork = document.getElementById("date_work"),
            elSizeWork = document.getElementById("size_work"),
            elDescription = document.getElementById("description"),
            elAudioPlayer = document.getElementById("audio_player"),
            elControlKeep = document.getElementById("keep"),
            elControlListen = document.getElementById("listen"),
            elControlPlay = document.getElementById("play"),
            elControlRecord = document.getElementById("record");

        appInteraction.showToast("Welcome to WauwMuseum!");
        //appInteraction.showBeacons();

        objRequestor = new solrRequest();

        var updateBestBeacon = function() {
                var strBestIdCropped, arrBestId, strBestId = appInteraction.getBestBeacon();
                if(strBestId && '' != strBestId.trim()) {
                    arrBestId = strBestId.split("-");
                    strBestIdCropped = arrBestId[arrBestId.length - 2] + "-" + arrBestId[arrBestId.length - 1];
                    elBestBeacon.innerText = strBestIdCropped;

                    if(strBestId != strBestBeaconId) {
                        strBestBeaconId = strBestId;
                        objRequestor.retrieveJson(strBestIdCropped, getResource);
                    }
                }
            },
            getResource = function(objResponseData) {
                //elPictureMain.src = objResponseData["solr"]["medium_image_url"];
                elPictureMain.style.backgroundImage = "url('" + objResponseData["solr"]["medium_image_url"] + "')";
                elNameArtist.innerText = objResponseData["solr"]["artist_name"].join(", ");
                elNameWork.innerText = objResponseData["solr"]["title_dk"];
                elDescription.innerText = objResponseData["solr"]["reference_texts"].split("GoogleArt;-1>;:")[1].replace(";-;", "").replace("\n", "<br>");
                if(undefined == elDescription.innerText || 'undefined' == elDescription.innerText) {
                    elDescription.innerText = "Der er desværre ingen beskrivelse til dette flotte stykke kunst :(";
                }
                elDateWork.innerText = objResponseData["solr"]["object_production_date_text_en"];
                elSizeWork.innerText = objResponseData["solr"]["heigth"] + " x "
                                     + objResponseData["solr"]["width"] + " " + objResponseData["solr"]["heigthunit"];
                loadAudio(objResponseData["audio"]["sound_file"]);
            },
            loadAudio = function(url) {
                if(elAudioPlayer.hasChildNodes()) {
                    elAudioPlayer.removeChild(elAudioPlayer.firstChild);
                }
                if(null == url) {
                    blnAudioPlaying = false;
                    return;
                }

                blnAudioPlaying = false;
                var elAudio = document.createElement('audio');
                elAudio.setAttribute('src', url);
                elAudio.load();
                elAudio.onloadstart = toggleAudio;
                elControlListen.onclick = toggleAudio;

                elAudioPlayer.appendChild(elAudio);
            },
            toggleAudio = function() {
                if(blnAudioPlaying) {
                    elAudioPlayer.firstChild.pause();
                    elControlListen.src = 'image/control_listen.png';
                    blnAudioPlaying = false;
                }
                else {
                    elAudioPlayer.firstChild.play();
                    elControlListen.src = 'image/control_listening.png';
                    blnAudioPlaying = true;
                }
            };

        setInterval(updateBestBeacon, 1000);

        //getResource({"solr":{"acq_method":"gave","artist_split":["Giovanni Battista Piranesi;1720;1720;1720;1778;1778;1778;Italiensk;original"],"medium_image_url":"http:\/\/cspic.smk.dk\/globus\/GLOBUS%202012\/kksgb9875-11.jpg","heigth":"523","artist_natio":["Italiensk"],"artist_birth_first":["1720"],"title_eng":"View of the Temple of Neptune [...]","acq_source":"Ny Carlsbergfondet","prod_technique_dk":"Streg\u00e6tsning","prod_technique_dk_ss":["Streg\u00e6tsning"],"artist_death_en":["1778"],"object_production_date_latest":"1778-12-31T00:00:00Z","object_type":"streg\u00e6tsning","id":"KKSgb9875\/11","id_s":"KKSgb9875\/11","heigthunit":"mm","last_update":"2013-09-16T06:28:39Z","object_production_date_text_dk":"(1778)","created":"2013-08-14T20:55:06Z","artists_data":"Giovanni Battista Piranesi;1720;1720;1720;1778;1778;1778;Italiensk;original","prod_technique_en":"Line etching","prod_technique_en_ss":["Line etching"],"artist_auth":["original"],"title_dk":"Neptun-templet [...]","title_dk_ss":["Neptun-templet [...]"],"artist_death_first":["1778"],"artist_birth_en":["1720"],"widthunit":"mm","object_production_date_earliest":"1778-01-01T00:00:00Z","width":"711","title_first":"Neptun-templet [...]","title_first_ss":["Neptun-templet [...]"],"description_note_dk":"Blad fra \"Diff\u00e9rentes vues de quelques Restes [...] de Pesto\" (Diverse udsigter med nogle af de levn [...] som stadig findes i centrum af den antikke by Pesto eller Paestum\"), en serie p\u00e5 21 blade, inkl. frontispiece, udgivet 1778 i Rom. Serien er blevet til i et samarbejde mellem Giovanni Battista Piranesi og s\u00f8nnen Francesco. Tre plader er signerede af Francesco, der menes at have bist\u00e5et ved tilblivelsen af de resterende 18 plader, som b\u00e6rer Giovanni Battista's signatur. 17 af de tegnede forl\u00e6g, der er bevarede, heraf 15 i Soane Museum, b\u00e6rer angiveligt spor af b\u00e5de faderens og s\u00f8nnens h\u00e6nder. Iflg. inv. protokol var KKS' eksemplar af serien ved erhvervelsen 1949 samlet i et bind fra omkring 1800, hvor forpermen var forsynet med et exlibris fra Sir Westman Dickinson Pearson, en engelsk entrepren\u00f8r fra 1800-tallet","csid":"dd1fbd3c-4336-4b7d-aacc-7f58bb0c5b6f","multi_work_ref":"parent;--;KKSgb9875;--;Diverse udsigter med nogle af de levn fra tre store bygningsv\u00e6rker, som stadig findes i centrum af den antikke by Pesto eller Paestum, der er beliggende i Lucania;--;;-;sibling;--;KKSgb9875\/1;--;Ruinerne af Neptuntemplets indre [...];--;;-;sibling;--;KKSgb9875\/10;--;Resterne af det s\u00e5kaldte College des Anfictions, set fra en anden vinkel [...];--;;-;sibling;--;KKSgb9875\/11;--;Neptun-templet [...];--;http:\/\/cspic.smk.dk\/globus\/GLOBUS%202012\/kksgb9875-11.jpg;-;sibling;--;KKSgb9875\/12;--;Neptun-templet i Paestum, set fra siden og forst\u00f8rret i forholdt til det f\u00f8rste blad;--;;-;sibling;--;KKSgb9875\/13;--;Det indre af Neptun-templet [...];--;;-;sibling;--;KKSgb9875\/14;--;Det indre af ruinerne af en af pronaoi til Neptun-templet [...];--;;-;sibling;--;KKSgb9875\/15;--;Resterne af det pronaos i Neptun-templet, som er afbildet i forrige blad [...];--;;-;sibling;--;KKSgb9875\/16;--;Ruinerne af Neptun-templets cella [...];--;http:\/\/cspic.smk.dk\/globus\/GLOBUS%202012\/kksgb9875-16.jpg;-;sibling;--;KKSgb9875\/17;--;Resterne af de to s\u00f8jler\u00e6kker i Neptun-templet [...];--;;-;sibling;--;KKSgb9875\/18;--;Resterne af cella i Neptun-templet [...];--;;-;sibling;--;KKSgb9875\/19;--;Et andet tempel i byen Paestum, et tempel, man mener har v\u00e6ret tilegnet gudinden Juno [...];--;;-;sibling;--;KKSgb9875\/2;--;Ruinerne af bymuren i den antikke by Paestum [...];--;http:\/\/cspic.smk.dk\/globus\/GLOBUS%202012\/kksgb9875-2.jpg;-;sibling;--;KKSgb9875\/20;--;Juno-templet set fra siden [...];--;;-;sibling;--;KKSgb9875\/21;--;Det indre af templet, som menes opf\u00f8rt for gudinden Juno [...];--;;-;sibling;--;KKSgb9875\/3;--;Ruinerne af det store s\u00f8jleomkransede rum, der udg\u00f8r en firkant [...];--;;-;sibling;--;KKSgb9875\/4;--;Resterne af nogle af de s\u00f8jler, som indg\u00e5r i facaden, modsat facaden afbildet i forrige blad [...];--;;-;sibling;--;KKSgb9875\/5;--;De 18 sides\u00f8jler, tegnet fra siden, modsat siden, som vistes i det f\u00f8rste blad [...];--;;-;sibling;--;KKSgb9875\/6;--;Ruinerne af pronaos til bygningen kendt som College des Anfictions [...];--;http:\/\/cspic.smk.dk\/globus\/GLOBUS%202012\/kksgb9875-6.jpg;-;sibling;--;KKSgb9875\/7;--;Facaden til pronaos, som er tegnet og beskrevet i planche V, set fra en anden vinkel [...];--;;-;sibling;--;KKSgb9875\/8;--;Det indre af det s\u00e5kaldte Coll\u00e8ge des Anfixions [...];--;;-;sibling;--;KKSgb9875\/9;--;Pronaos, set fra en anden vinkel [...];--;","artist_death_dk":["1778"],"object_production_date_text_en":"1778","category":["collections"],"artist_name":["Giovanni Battista Piranesi"],"artist_name_ss":["Giovanni Battista Piranesi"],"proveniens":"Sir Westman Dickinson Pearson; Branners Bibliofile Antikvariat, K\u00f8benhavn; k\u00f8bt herfra af Ny Carlsbergfondet og for\u00e6ret til KKS i 1949","object_production_century_earliest":18,"artist_birth_dk":["1720"],"acq_date":"1949","_version_":1480354364414492672},"audio":{"id":"18499-19998","sound_file":"http:\/\/www.gotfuturama.com\/Multimedia\/EpisodeSounds\/1ACV02\/07.mp3"}});
    </script>
</body>
</html>
